<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Week 9 - 資料庫操作與 SQL | Python 程式設計</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-sql.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', 'Microsoft JhengHei', Arial, sans-serif;
            background: linear-gradient(to bottom, #f5f7fa 0%, #c3cfe2 100%);
            color: #2c3e50;
            line-height: 1.7;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
        }

        .nav {
            background: white;
            padding: 15px 25px;
            border-radius: 8px;
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .nav a {
            color: #3776ab;
            text-decoration: none;
            font-weight: 600;
            padding: 8px 16px;
            border-radius: 4px;
            transition: all 0.3s ease;
        }

        .nav a:hover {
            background: #3776ab;
            color: white;
        }

        header {
            background: linear-gradient(135deg, #3776ab 0%, #ffd343 100%);
            color: white;
            padding: 50px 40px;
            border-radius: 8px;
            margin-bottom: 30px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        header .subtitle {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .content {
            background: white;
            border-radius: 8px;
            padding: 40px;
            margin-bottom: 30px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .content h2 {
            color: #2c3e50;
            font-size: 2em;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #3776ab;
        }

        .content h3 {
            color: #34495e;
            font-size: 1.5em;
            margin: 30px 0 15px 0;
        }

        .content h4 {
            color: #34495e;
            font-size: 1.2em;
            margin: 20px 0 10px 0;
        }

        pre[class*="language-"] {
            margin: 20px 0;
            border-radius: 8px;
            border: 2px solid #3776ab;
        }

        code[class*="language-"] {
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 0.95em;
            line-height: 1.6;
        }

        .note-box {
            background: #e8f4f8;
            border-left: 4px solid #3776ab;
            padding: 20px;
            margin: 20px 0;
            border-radius: 4px;
        }

        .warning-box {
            background: #fff8e1;
            border-left: 4px solid #ffa726;
            padding: 20px;
            margin: 20px 0;
            border-radius: 4px;
        }

        .tip-box {
            background: #e8f5e9;
            border-left: 4px solid #66bb6a;
            padding: 20px;
            margin: 20px 0;
            border-radius: 4px;
        }

        .exercise-section {
            background: #f8f9fa;
            border: 2px solid #3776ab;
            padding: 30px;
            margin: 30px 0;
            border-radius: 8px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }

        table th,
        table td {
            padding: 12px;
            text-align: left;
            border: 1px solid #ddd;
        }

        table th {
            background: #3776ab;
            color: white;
            font-weight: 600;
        }

        table tr:nth-child(even) {
            background: #f8f9fa;
        }

        ul, ol {
            margin-left: 30px;
            margin-top: 10px;
        }

        li {
            margin: 8px 0;
        }

        .nav-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 40px;
        }

        .btn {
            display: inline-block;
            padding: 12px 30px;
            background: #3776ab;
            color: white;
            text-decoration: none;
            border-radius: 4px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn:hover {
            background: #2d5a8a;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .btn-secondary {
            background: #95a5a6;
        }

        .btn-secondary:hover {
            background: #7f8c8d;
        }

        .sql-box {
            background: #f0f4f8;
            border-left: 4px solid #2196f3;
            padding: 20px;
            margin: 20px 0;
            border-radius: 4px;
        }

        .concept-box {
            background: #f3e5f5;
            border-left: 4px solid #9c27b0;
            padding: 20px;
            margin: 20px 0;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="nav">
            <a href="python-week8-part2.html">← Week 8</a>
            <span style="color: #7f8c8d; font-weight: 600;">Week 9 / 16</span>
            <a href="python-week10.html">Week 10 →</a>
        </div>

        <header>
            <h1>Week 9 - 資料庫操作與 SQL</h1>
            <div class="subtitle">學習目標：掌握關聯式資料庫概念，學會使用 SQL 與 Python 操作資料庫</div>
        </header>

        <div class="content">
            <h2>本週學習內容</h2>
            <ul>
                <li>資料庫基本概念</li>
                <li>SQL 基礎語法（DDL、DML）</li>
                <li>SQLite 資料庫簡介</li>
                <li>Python sqlite3 模組</li>
                <li>CRUD 操作（增刪改查）</li>
                <li>資料庫設計原則</li>
                <li>SQL 進階查詢</li>
                <li>交易處理</li>
                <li>實用專案範例</li>
            </ul>
        </div>

        <div class="content">
            <h2>1. 資料庫基本概念</h2>
            
            <h3>什麼是資料庫？</h3>
            <p>資料庫（Database）是有組織地儲存和管理資料的系統。關聯式資料庫（RDBMS）使用表格（Table）來組織資料。</p>

            <div class="concept-box">
                <h4>關鍵概念：</h4>
                <ul>
                    <li><strong>資料庫（Database）</strong>：儲存資料的容器</li>
                    <li><strong>表格（Table）</strong>：資料的集合，類似 Excel 工作表</li>
                    <li><strong>欄位（Column/Field）</strong>：表格的直行，定義資料類型</li>
                    <li><strong>記錄（Row/Record）</strong>：表格的橫列，一筆完整資料</li>
                    <li><strong>主鍵（Primary Key）</strong>：唯一識別每筆記錄的欄位</li>
                    <li><strong>外鍵（Foreign Key）</strong>：連結不同表格的欄位</li>
                </ul>
            </div>

            <h3>資料庫 vs 檔案系統</h3>
            <table>
                <tr>
                    <th>特性</th>
                    <th>檔案系統</th>
                    <th>資料庫系統</th>
                </tr>
                <tr>
                    <td>資料組織</td>
                    <td>簡單、扁平</td>
                    <td>結構化、關聯</td>
                </tr>
                <tr>
                    <td>查詢效率</td>
                    <td>需要讀取整個檔案</td>
                    <td>快速索引查詢</td>
                </tr>
                <tr>
                    <td>並行存取</td>
                    <td>困難</td>
                    <td>支援多人同時存取</td>
                </tr>
                <tr>
                    <td>資料完整性</td>
                    <td>需要自己處理</td>
                    <td>內建驗證機制</td>
                </tr>
                <tr>
                    <td>交易處理</td>
                    <td>不支援</td>
                    <td>ACID 特性保證</td>
                </tr>
                <tr>
                    <td>適用情境</td>
                    <td>簡單、小型資料</td>
                    <td>複雜、大型資料</td>
                </tr>
            </table>

            <h3>常見的資料庫系統</h3>
            <table>
                <tr>
                    <th>資料庫</th>
                    <th>類型</th>
                    <th>特點</th>
                    <th>適用情境</th>
                </tr>
                <tr>
                    <td>SQLite</td>
                    <td>檔案型</td>
                    <td>輕量、不需伺服器</td>
                    <td>小型應用、學習</td>
                </tr>
                <tr>
                    <td>MySQL</td>
                    <td>伺服器型</td>
                    <td>開源、易用</td>
                    <td>網站、Web 應用</td>
                </tr>
                <tr>
                    <td>PostgreSQL</td>
                    <td>伺服器型</td>
                    <td>功能強大、支援複雜查詢</td>
                    <td>企業級應用</td>
                </tr>
                <tr>
                    <td>MongoDB</td>
                    <td>NoSQL</td>
                    <td>文件型、靈活</td>
                    <td>非結構化資料</td>
                </tr>
            </table>

            <div class="note-box">
                <strong>本課程使用 SQLite：</strong>
                <p>SQLite 是 Python 內建的資料庫，不需要額外安裝，非常適合學習和小型專案。</p>
                <ul>
                    <li>✓ 不需要設定伺服器</li>
                    <li>✓ 單一檔案儲存</li>
                    <li>✓ 跨平台</li>
                    <li>✓ 輕量快速</li>
                </ul>
            </div>
        </div>

        <div class="content">
            <h2>2. SQL 基礎語法</h2>
            
            <h3>SQL 語言分類</h3>
            <table>
                <tr>
                    <th>類別</th>
                    <th>說明</th>
                    <th>常用指令</th>
                </tr>
                <tr>
                    <td>DDL<br>（Data Definition Language）</td>
                    <td>資料定義語言<br>定義資料庫結構</td>
                    <td>CREATE, ALTER, DROP</td>
                </tr>
                <tr>
                    <td>DML<br>（Data Manipulation Language）</td>
                    <td>資料操作語言<br>操作資料</td>
                    <td>SELECT, INSERT, UPDATE, DELETE</td>
                </tr>
                <tr>
                    <td>DCL<br>（Data Control Language）</td>
                    <td>資料控制語言<br>權限管理</td>
                    <td>GRANT, REVOKE</td>
                </tr>
                <tr>
                    <td>TCL<br>（Transaction Control Language）</td>
                    <td>交易控制語言<br>交易管理</td>
                    <td>COMMIT, ROLLBACK</td>
                </tr>
            </table>

            <h3>SQL 資料類型（SQLite）</h3>
            <table>
                <tr>
                    <th>資料類型</th>
                    <th>說明</th>
                    <th>範例</th>
                </tr>
                <tr>
                    <td>INTEGER</td>
                    <td>整數</td>
                    <td>1, 100, -5</td>
                </tr>
                <tr>
                    <td>REAL</td>
                    <td>浮點數</td>
                    <td>3.14, 2.5</td>
                </tr>
                <tr>
                    <td>TEXT</td>
                    <td>文字字串</td>
                    <td>'Hello', '中文'</td>
                </tr>
                <tr>
                    <td>BLOB</td>
                    <td>二進位資料</td>
                    <td>圖片、檔案</td>
                </tr>
                <tr>
                    <td>NULL</td>
                    <td>空值</td>
                    <td>NULL</td>
                </tr>
            </table>

            <h3>CREATE - 建立資料表</h3>
            <pre><code class="language-sql">-- 建立學生資料表
CREATE TABLE students (
    id INTEGER PRIMARY KEY AUTOINCREMENT,  -- 主鍵，自動遞增
    name TEXT NOT NULL,                    -- 姓名，不可為空
    age INTEGER,                           -- 年齡
    grade TEXT,                            -- 年級
    email TEXT UNIQUE,                     -- Email，唯一值
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP  -- 建立時間
);

-- 建立課程資料表
CREATE TABLE courses (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    name TEXT NOT NULL,
    credits INTEGER,
    teacher TEXT
);

-- 建立選課資料表（多對多關係）
CREATE TABLE enrollments (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    student_id INTEGER,
    course_id INTEGER,
    grade REAL,
    FOREIGN KEY (student_id) REFERENCES students(id),
    FOREIGN KEY (course_id) REFERENCES courses(id)
);
</code></pre>

            <h3>INSERT - 新增資料</h3>
            <pre><code class="language-sql">-- 新增單筆資料
INSERT INTO students (name, age, grade, email)
VALUES ('Alice', 20, 'A', 'alice@example.com');

-- 新增多筆資料
INSERT INTO students (name, age, grade, email) VALUES
    ('Bob', 21, 'B', 'bob@example.com'),
    ('Charlie', 19, 'A', 'charlie@example.com'),
    ('David', 22, 'C', 'david@example.com');

-- 部分欄位新增（其他使用預設值或 NULL）
INSERT INTO students (name, age)
VALUES ('Eve', 20);
</code></pre>

            <h3>SELECT - 查詢資料</h3>
            <pre><code class="language-sql">-- 查詢所有資料
SELECT * FROM students;

-- 查詢特定欄位
SELECT name, age FROM students;

-- 條件查詢（WHERE）
SELECT * FROM students WHERE age >= 20;
SELECT * FROM students WHERE grade = 'A';
SELECT * FROM students WHERE age BETWEEN 20 AND 22;
SELECT * FROM students WHERE name LIKE 'A%';  -- 以 A 開頭

-- 多重條件
SELECT * FROM students WHERE age >= 20 AND grade = 'A';
SELECT * FROM students WHERE grade = 'A' OR grade = 'B';

-- 排序（ORDER BY）
SELECT * FROM students ORDER BY age;           -- 升冪（預設）
SELECT * FROM students ORDER BY age DESC;      -- 降冪
SELECT * FROM students ORDER BY grade, age;    -- 多欄位排序

-- 限制筆數（LIMIT）
SELECT * FROM students LIMIT 5;                -- 前 5 筆
SELECT * FROM students LIMIT 5 OFFSET 10;      -- 跳過 10 筆，取 5 筆

-- 去除重複（DISTINCT）
SELECT DISTINCT grade FROM students;

-- 計數
SELECT COUNT(*) FROM students;                 -- 總筆數
SELECT COUNT(*) FROM students WHERE age >= 20; -- 條件計數
</code></pre>

            <h3>UPDATE - 更新資料</h3>
            <pre><code class="language-sql">-- 更新單一欄位
UPDATE students SET age = 21 WHERE name = 'Alice';

-- 更新多個欄位
UPDATE students 
SET age = 23, grade = 'A' 
WHERE name = 'Bob';

-- 條件更新
UPDATE students SET grade = 'B' WHERE age >= 20;

-- 更新所有資料（危險！）
UPDATE students SET grade = 'A';  -- 建議加上 WHERE 條件
</code></pre>

            <h3>DELETE - 刪除資料</h3>
            <pre><code class="language-sql">-- 刪除特定資料
DELETE FROM students WHERE name = 'Charlie';

-- 條件刪除
DELETE FROM students WHERE age < 18;

-- 刪除所有資料（危險！）
DELETE FROM students;  -- 建議加上 WHERE 條件

-- 重置資料表（刪除並重建）
DROP TABLE IF EXISTS students;
CREATE TABLE students (...);
</code></pre>

            <div class="warning-box">
                <strong>重要提醒：</strong>
                <ul>
                    <li>UPDATE 和 DELETE 務必加上 WHERE 條件，避免誤改全部資料</li>
                    <li>在執行刪除或更新前，先用 SELECT 確認會影響哪些資料</li>
                    <li>重要資料修改前建議先備份</li>
                </ul>
            </div>
        </div>

        <div class="content">
            <h2>3. Python 操作 SQLite</h2>
            
            <h3>基本連線與操作</h3>
            <pre><code class="language-python">import sqlite3

# 連線到資料庫（檔案不存在會自動建立）
conn = sqlite3.connect('school.db')

# 建立 cursor 物件
cursor = conn.cursor()

# 執行 SQL 指令
cursor.execute('''
    CREATE TABLE IF NOT EXISTS students (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        name TEXT NOT NULL,
        age INTEGER,
        grade TEXT
    )
''')

# 提交變更
conn.commit()

# 關閉連線
conn.close()

print("資料庫建立成功！")
</code></pre>

            <h3>完整的資料庫操作類別</h3>
            <pre><code class="language-python">import sqlite3
from typing import List, Tuple, Optional

class StudentDatabase:
    """學生資料庫管理類別"""
    
    def __init__(self, db_name='school.db'):
        """初始化資料庫連線"""
        self.db_name = db_name
        self.conn = None
        self.cursor = None
        self._connect()
        self._create_table()
    
    def _connect(self):
        """連線到資料庫"""
        self.conn = sqlite3.connect(self.db_name)
        self.cursor = self.conn.cursor()
    
    def _create_table(self):
        """建立資料表"""
        self.cursor.execute('''
            CREATE TABLE IF NOT EXISTS students (
                id INTEGER PRIMARY KEY AUTOINCREMENT,
                name TEXT NOT NULL,
                age INTEGER,
                grade TEXT,
                email TEXT UNIQUE
            )
        ''')
        self.conn.commit()
    
    def add_student(self, name: str, age: int, grade: str, email: str) -> int:
        """新增學生"""
        try:
            self.cursor.execute(
                'INSERT INTO students (name, age, grade, email) VALUES (?, ?, ?, ?)',
                (name, age, grade, email)
            )
            self.conn.commit()
            return self.cursor.lastrowid  # 返回新增記錄的 ID
        except sqlite3.IntegrityError as e:
            print(f"錯誤：{e}")
            return -1
    
    def get_student(self, student_id: int) -> Optional[Tuple]:
        """查詢單一學生"""
        self.cursor.execute(
            'SELECT * FROM students WHERE id = ?',
            (student_id,)
        )
        return self.cursor.fetchone()
    
    def get_all_students(self) -> List[Tuple]:
        """查詢所有學生"""
        self.cursor.execute('SELECT * FROM students')
        return self.cursor.fetchall()
    
    def get_students_by_grade(self, grade: str) -> List[Tuple]:
        """按年級查詢學生"""
        self.cursor.execute(
            'SELECT * FROM students WHERE grade = ?',
            (grade,)
        )
        return self.cursor.fetchall()
    
    def update_student(self, student_id: int, **kwargs):
        """更新學生資料"""
        # 動態建立 UPDATE 語句
        fields = []
        values = []
        
        for key, value in kwargs.items():
            if key in ['name', 'age', 'grade', 'email']:
                fields.append(f'{key} = ?')
                values.append(value)
        
        if not fields:
            return
        
        values.append(student_id)
        sql = f"UPDATE students SET {', '.join(fields)} WHERE id = ?"
        
        self.cursor.execute(sql, values)
        self.conn.commit()
    
    def delete_student(self, student_id: int):
        """刪除學生"""
        self.cursor.execute(
            'DELETE FROM students WHERE id = ?',
            (student_id,)
        )
        self.conn.commit()
    
    def search_students(self, keyword: str) -> List[Tuple]:
        """搜尋學生（按姓名）"""
        self.cursor.execute(
            'SELECT * FROM students WHERE name LIKE ?',
            (f'%{keyword}%',)
        )
        return self.cursor.fetchall()
    
    def get_student_count(self) -> int:
        """取得學生總數"""
        self.cursor.execute('SELECT COUNT(*) FROM students')
        return self.cursor.fetchone()[0]
    
    def close(self):
        """關閉資料庫連線"""
        if self.conn:
            self.conn.close()
    
    def __enter__(self):
        """支援 with 語句"""
        return self
    
    def __exit__(self, exc_type, exc_val, exc_tb):
        """支援 with 語句"""
        self.close()


# 使用範例
if __name__ == '__main__':
    # 使用 with 語句自動管理連線
    with StudentDatabase() as db:
        # 新增學生
        print("=== 新增學生 ===")
        db.add_student('Alice', 20, 'A', 'alice@example.com')
        db.add_student('Bob', 21, 'B', 'bob@example.com')
        db.add_student('Charlie', 19, 'A', 'charlie@example.com')
        db.add_student('David', 22, 'C', 'david@example.com')
        print("學生新增完成")
        
        # 查詢所有學生
        print("\n=== 所有學生 ===")
        students = db.get_all_students()
        for student in students:
            print(f"ID: {student[0]}, 姓名: {student[1]}, "
                  f"年齡: {student[2]}, 成績: {student[3]}")
        
        # 查詢特定學生
        print("\n=== 查詢 ID=1 的學生 ===")
        student = db.get_student(1)
        if student:
            print(f"姓名: {student[1]}, 年齡: {student[2]}")
        
        # 按年級查詢
        print("\n=== A 年級學生 ===")
        a_students = db.get_students_by_grade('A')
        for student in a_students:
            print(f"姓名: {student[1]}")
        
        # 更新學生
        print("\n=== 更新學生資料 ===")
        db.update_student(1, age=21, grade='A+')
        print("更新完成")
        
        # 搜尋學生
        print("\n=== 搜尋包含 'ar' 的學生 ===")
        results = db.search_students('ar')
        for student in results:
            print(f"姓名: {student[1]}")
        
        # 取得學生總數
        print(f"\n總學生數：{db.get_student_count()}")
        
        # 刪除學生
        print("\n=== 刪除 ID=4 的學生 ===")
        db.delete_student(4)
        print("刪除完成")
        
        # 確認刪除
        print(f"刪除後總學生數：{db.get_student_count()}")
</code></pre>

            <h3>使用參數化查詢（防止 SQL Injection）</h3>
            <pre><code class="language-python">import sqlite3

conn = sqlite3.connect('school.db')
cursor = conn.cursor()

# ✗ 錯誤：字串拼接（有 SQL Injection 風險）
name = "Alice'; DROP TABLE students; --"
cursor.execute(f"SELECT * FROM students WHERE name = '{name}'")

# ✓ 正確：使用參數化查詢
name = "Alice"
cursor.execute('SELECT * FROM students WHERE name = ?', (name,))

# 多個參數
cursor.execute(
    'SELECT * FROM students WHERE age >= ? AND grade = ?',
    (20, 'A')
)

# 命名參數
cursor.execute(
    'SELECT * FROM students WHERE age >= :age AND grade = :grade',
    {'age': 20, 'grade': 'A'}
)

conn.close()
</code></pre>

            <div class="warning-box">
                <strong>安全性提醒：</strong>
                <p>永遠使用參數化查詢（?）而不是字串拼接，以防止 SQL Injection 攻擊！</p>
            </div>
        </div>

        <div class="content">
            <h2>4. SQL 進階查詢</h2>
            
            <h3>聚合函數</h3>
            <pre><code class="language-sql">-- COUNT：計數
SELECT COUNT(*) FROM students;
SELECT COUNT(*) FROM students WHERE age >= 20;
SELECT COUNT(DISTINCT grade) FROM students;  -- 不重複的年級數

-- AVG：平均值
SELECT AVG(age) FROM students;
SELECT AVG(age) FROM students WHERE grade = 'A';

-- SUM：總和
SELECT SUM(age) FROM students;

-- MAX / MIN：最大 / 最小值
SELECT MAX(age) FROM students;
SELECT MIN(age) FROM students;

-- 組合使用
SELECT 
    COUNT(*) as total,
    AVG(age) as avg_age,
    MAX(age) as max_age,
    MIN(age) as min_age
FROM students;
</code></pre>

            <h3>GROUP BY - 分組查詢</h3>
            <pre><code class="language-sql">-- 按年級分組統計
SELECT grade, COUNT(*) as student_count
FROM students
GROUP BY grade;

-- 按年級分組，計算平均年齡
SELECT grade, AVG(age) as avg_age
FROM students
GROUP BY grade;

-- HAVING：對分組結果進行篩選
SELECT grade, COUNT(*) as student_count
FROM students
GROUP BY grade
HAVING COUNT(*) >= 2;  -- 只顯示人數 >= 2 的年級

-- 多欄位分組
SELECT grade, age, COUNT(*) as count
FROM students
GROUP BY grade, age
ORDER BY grade, age;
</code></pre>

            <h3>JOIN - 資料表連結</h3>
            <pre><code class="language-sql">-- 建立測試資料
CREATE TABLE courses (
    id INTEGER PRIMARY KEY,
    name TEXT NOT NULL
);

CREATE TABLE enrollments (
    id INTEGER PRIMARY KEY,
    student_id INTEGER,
    course_id INTEGER,
    score REAL
);

INSERT INTO courses VALUES 
    (1, 'Python 程式設計'),
    (2, '資料結構'),
    (3, '資料庫系統');

INSERT INTO enrollments VALUES
    (1, 1, 1, 95),
    (2, 1, 2, 88),
    (3, 2, 1, 92),
    (4, 2, 3, 85);


-- INNER JOIN：只返回兩表都有的資料
SELECT 
    students.name as student_name,
    courses.name as course_name,
    enrollments.score
FROM students
INNER JOIN enrollments ON students.id = enrollments.student_id
INNER JOIN courses ON courses.id = enrollments.course_id;

-- LEFT JOIN：返回左表所有資料，右表沒有則為 NULL
SELECT 
    students.name,
    courses.name,
    enrollments.score
FROM students
LEFT JOIN enrollments ON students.id = enrollments.student_id
LEFT JOIN courses ON courses.id = enrollments.course_id;

-- 查詢學生的平均成績
SELECT 
    students.name,
    AVG(enrollments.score) as avg_score
FROM students
LEFT JOIN enrollments ON students.id = enrollments.student_id
GROUP BY students.id
ORDER BY avg_score DESC;
</code></pre>

            <h3>子查詢（Subquery）</h3>
            <pre><code class="language-sql">-- 查詢年齡大於平均年齡的學生
SELECT * FROM students
WHERE age > (SELECT AVG(age) FROM students);

-- IN 子查詢
SELECT * FROM students
WHERE id IN (
    SELECT student_id FROM enrollments WHERE score >= 90
);

-- EXISTS 子查詢
SELECT * FROM students
WHERE EXISTS (
    SELECT 1 FROM enrollments 
    WHERE enrollments.student_id = students.id
);
</code></pre>

            <h3>Python 實作進階查詢</h3>
            <pre><code class="language-python">import sqlite3

class AdvancedDatabase:
    """進階資料庫查詢"""
    
    def __init__(self, db_name='school.db'):
        self.conn = sqlite3.connect(db_name)
        self.cursor = self.conn.cursor()
        # 設定返回字典格式
        self.conn.row_factory = sqlite3.Row
        self.cursor = self.conn.cursor()
    
    def get_student_statistics(self):
        """取得學生統計資訊"""
        self.cursor.execute('''
            SELECT 
                COUNT(*) as total,
                AVG(age) as avg_age,
                MAX(age) as max_age,
                MIN(age) as min_age
            FROM students
        ''')
        row = self.cursor.fetchone()
        return dict(row)
    
    def get_grade_statistics(self):
        """按年級統計"""
        self.cursor.execute('''
            SELECT 
                grade,
                COUNT(*) as student_count,
                AVG(age) as avg_age
            FROM students
            GROUP BY grade
            ORDER BY grade
        ''')
        return [dict(row) for row in self.cursor.fetchall()]
    
    def get_student_courses(self, student_id):
        """查詢學生的所有課程和成績"""
        self.cursor.execute('''
            SELECT 
                courses.name as course_name,
                enrollments.score
            FROM enrollments
            INNER JOIN courses ON courses.id = enrollments.course_id
            WHERE enrollments.student_id = ?
        ''', (student_id,))
        return [dict(row) for row in self.cursor.fetchall()]
    
    def get_top_students(self, limit=5):
        """查詢成績最好的前 N 名學生"""
        self.cursor.execute('''
            SELECT 
                students.name,
                AVG(enrollments.score) as avg_score
            FROM students
            INNER JOIN enrollments ON students.id = enrollments.student_id
            GROUP BY students.id
            ORDER BY avg_score DESC
            LIMIT ?
        ''', (limit,))
        return [dict(row) for row in self.cursor.fetchall()]
    
    def close(self):
        self.conn.close()


# 使用範例
db = AdvancedDatabase()

print("=== 學生統計 ===")
stats = db.get_student_statistics()
print(f"總人數：{stats['total']}")
print(f"平均年齡：{stats['avg_age']:.2f}")

print("\n=== 年級統計 ===")
grade_stats = db.get_grade_statistics()
for stat in grade_stats:
    print(f"年級 {stat['grade']}：{stat['student_count']} 人，"
          f"平均年齡 {stat['avg_age']:.2f}")

db.close()
</code></pre>
        </div>

        <div class="content">
            <h2>5. 交易處理</h2>
            
            <h3>什麼是交易（Transaction）？</h3>
            <p>交易是一組必須全部成功或全部失敗的操作，遵循 ACID 特性：</p>
            
            <div class="concept-box">
                <h4>ACID 特性：</h4>
                <ul>
                    <li><strong>Atomicity（原子性）</strong>：交易是不可分割的單位</li>
                    <li><strong>Consistency（一致性）</strong>：交易前後資料保持一致</li>
                    <li><strong>Isolation（隔離性）</strong>：交易之間互不干擾</li>
                    <li><strong>Durability（持久性）</strong>：交易完成後永久保存</li>
                </ul>
            </div>

            <h3>交易處理範例</h3>
            <pre><code class="language-python">import sqlite3

class BankAccount:
    """銀行帳戶管理（示範交易處理）"""
    
    def __init__(self, db_name='bank.db'):
        self.conn = sqlite3.connect(db_name)
        self.cursor = self.conn.cursor()
        self._create_table()
    
    def _create_table(self):
        """建立帳戶資料表"""
        self.cursor.execute('''
            CREATE TABLE IF NOT EXISTS accounts (
                id INTEGER PRIMARY KEY AUTOINCREMENT,
                name TEXT NOT NULL,
                balance REAL NOT NULL DEFAULT 0
            )
        ''')
        self.conn.commit()
    
    def create_account(self, name, initial_balance=0):
        """建立帳戶"""
        self.cursor.execute(
            'INSERT INTO accounts (name, balance) VALUES (?, ?)',
            (name, initial_balance)
        )
        self.conn.commit()
        return self.cursor.lastrowid
    
    def get_balance(self, account_id):
        """查詢餘額"""
        self.cursor.execute(
            'SELECT balance FROM accounts WHERE id = ?',
            (account_id,)
        )
        result = self.cursor.fetchone()
        return result[0] if result else None
    
    def transfer(self, from_account, to_account, amount):
        """轉帳（使用交易處理）"""
        try:
            # 開始交易
            self.conn.execute('BEGIN TRANSACTION')
            
            # 1. 檢查來源帳戶餘額
            balance = self.get_balance(from_account)
            if balance is None:
                raise ValueError("來源帳戶不存在")
            if balance < amount:
                raise ValueError("餘額不足")
            
            # 2. 檢查目標帳戶
            if self.get_balance(to_account) is None:
                raise ValueError("目標帳戶不存在")
            
            # 3. 扣款
            self.cursor.execute(
                'UPDATE accounts SET balance = balance - ? WHERE id = ?',
                (amount, from_account)
            )
            
            # 4. 入帳
            self.cursor.execute(
                'UPDATE accounts SET balance = balance + ? WHERE id = ?',
                (amount, to_account)
            )
            
            # 提交交易
            self.conn.commit()
            print(f"轉帳成功：{amount} 元")
            return True
            
        except Exception as e:
            # 發生錯誤，回復所有變更
            self.conn.rollback()
            print(f"轉帳失敗：{e}")
            return False
    
    def close(self):
        self.conn.close()


# 使用範例
bank = BankAccount()

# 建立帳戶
acc1 = bank.create_account('Alice', 1000)
acc2 = bank.create_account('Bob', 500)

print(f"Alice 餘額：{bank.get_balance(acc1)}")
print(f"Bob 餘額：{bank.get_balance(acc2)}")

# 轉帳
print("\n=== 轉帳 300 元從 Alice 到 Bob ===")
bank.transfer(acc1, acc2, 300)

print(f"Alice 餘額：{bank.get_balance(acc1)}")
print(f"Bob 餘額：{bank.get_balance(acc2)}")

# 嘗試轉帳過多金額（會失敗並回復）
print("\n=== 嘗試轉帳 1000 元（餘額不足）===")
bank.transfer(acc1, acc2, 1000)

print(f"Alice 餘額：{bank.get_balance(acc1)}")
print(f"Bob 餘額：{bank.get_balance(acc2)}")

bank.close()
</code></pre>

            <h3>Context Manager 自動處理交易</h3>
            <pre><code class="language-python">import sqlite3
from contextlib import contextmanager

@contextmanager
def transaction(conn):
    """交易 context manager"""
    try:
        yield conn
        conn.commit()
    except Exception:
        conn.rollback()
        raise


# 使用範例
conn = sqlite3.connect('school.db')

try:
    with transaction(conn):
        cursor = conn.cursor()
        cursor.execute('INSERT INTO students (name, age) VALUES (?, ?)', 
                      ('Alice', 20))
        cursor.execute('INSERT INTO students (name, age) VALUES (?, ?)', 
                      ('Bob', 21))
        # 所有操作成功，自動 commit
except Exception as e:
    print(f"交易失敗：{e}")
    # 自動 rollback

conn.close()
</code></pre>
        </div>

        <div class="content">
            <h2>6. 實用專案範例</h2>
            
            <h3>學生管理系統（完整版）</h3>
            <pre><code class="language-python">import sqlite3
from datetime import datetime
from typing import List, Optional, Dict

class StudentManagementSystem:
    """完整的學生管理系統"""
    
    def __init__(self, db_name='student_system.db'):
        self.conn = sqlite3.connect(db_name)
        self.conn.row_factory = sqlite3.Row
        self.cursor = self.conn.cursor()
        self._init_database()
    
    def _init_database(self):
        """初始化資料庫結構"""
        # 學生表
        self.cursor.execute('''
            CREATE TABLE IF NOT EXISTS students (
                id INTEGER PRIMARY KEY AUTOINCREMENT,
                student_id TEXT UNIQUE NOT NULL,
                name TEXT NOT NULL,
                age INTEGER,
                gender TEXT,
                phone TEXT,
                email TEXT UNIQUE,
                created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
            )
        ''')
        
        # 課程表
        self.cursor.execute('''
            CREATE TABLE IF NOT EXISTS courses (
                id INTEGER PRIMARY KEY AUTOINCREMENT,
                course_code TEXT UNIQUE NOT NULL,
                name TEXT NOT NULL,
                credits INTEGER,
                teacher TEXT
            )
        ''')
        
        # 選課表
        self.cursor.execute('''
            CREATE TABLE IF NOT EXISTS enrollments (
                id INTEGER PRIMARY KEY AUTOINCREMENT,
                student_id INTEGER,
                course_id INTEGER,
                score REAL,
                semester TEXT,
                enrolled_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
                FOREIGN KEY (student_id) REFERENCES students(id),
                FOREIGN KEY (course_id) REFERENCES courses(id),
                UNIQUE(student_id, course_id, semester)
            )
        ''')
        
        self.conn.commit()
    
    # === 學生管理 ===
    def add_student(self, student_id: str, name: str, age: int, 
                   gender: str, phone: str = None, email: str = None) -> int:
        """新增學生"""
        try:
            self.cursor.execute('''
                INSERT INTO students (student_id, name, age, gender, phone, email)
                VALUES (?, ?, ?, ?, ?, ?)
            ''', (student_id, name, age, gender, phone, email))
            self.conn.commit()
            return self.cursor.lastrowid
        except sqlite3.IntegrityError as e:
            print(f"錯誤：{e}")
            return -1
    
    def get_student(self, student_id: str) -> Optional[Dict]:
        """查詢學生"""
        self.cursor.execute(
            'SELECT * FROM students WHERE student_id = ?',
            (student_id,)
        )
        row = self.cursor.fetchone()
        return dict(row) if row else None
    
    def update_student(self, student_id: str, **kwargs):
        """更新學生資料"""
        allowed_fields = ['name', 'age', 'gender', 'phone', 'email']
        updates = []
        values = []
        
        for key, value in kwargs.items():
            if key in allowed_fields and value is not None:
                updates.append(f'{key} = ?')
                values.append(value)
        
        if updates:
            values.append(student_id)
            sql = f"UPDATE students SET {', '.join(updates)} WHERE student_id = ?"
            self.cursor.execute(sql, values)
            self.conn.commit()
    
    def delete_student(self, student_id: str):
        """刪除學生（級聯刪除選課記錄）"""
        # 先刪除選課記錄
        self.cursor.execute('''
            DELETE FROM enrollments 
            WHERE student_id = (SELECT id FROM students WHERE student_id = ?)
        ''', (student_id,))
        
        # 再刪除學生
        self.cursor.execute(
            'DELETE FROM students WHERE student_id = ?',
            (student_id,)
        )
        self.conn.commit()
    
    def search_students(self, keyword: str) -> List[Dict]:
        """搜尋學生"""
        self.cursor.execute('''
            SELECT * FROM students 
            WHERE name LIKE ? OR student_id LIKE ? OR email LIKE ?
        ''', (f'%{keyword}%', f'%{keyword}%', f'%{keyword}%'))
        return [dict(row) for row in self.cursor.fetchall()]
    
    # === 課程管理 ===
    def add_course(self, course_code: str, name: str, 
                   credits: int, teacher: str) -> int:
        """新增課程"""
        try:
            self.cursor.execute('''
                INSERT INTO courses (course_code, name, credits, teacher)
                VALUES (?, ?, ?, ?)
            ''', (course_code, name, credits, teacher))
            self.conn.commit()
            return self.cursor.lastrowid
        except sqlite3.IntegrityError:
            return -1
    
    def get_all_courses(self) -> List[Dict]:
        """查詢所有課程"""
        self.cursor.execute('SELECT * FROM courses')
        return [dict(row) for row in self.cursor.fetchall()]
    
    # === 選課管理 ===
    def enroll_course(self, student_id: str, course_code: str, 
                     semester: str) -> bool:
        """學生選課"""
        try:
            self.cursor.execute('''
                INSERT INTO enrollments (student_id, course_id, semester)
                SELECT s.id, c.id, ?
                FROM students s, courses c
                WHERE s.student_id = ? AND c.course_code = ?
            ''', (semester, student_id, course_code))
            self.conn.commit()
            return True
        except sqlite3.IntegrityError:
            return False
    
    def update_score(self, student_id: str, course_code: str, 
                    semester: str, score: float):
        """更新成績"""
        self.cursor.execute('''
            UPDATE enrollments
            SET score = ?
            WHERE student_id = (SELECT id FROM students WHERE student_id = ?)
            AND course_id = (SELECT id FROM courses WHERE course_code = ?)
            AND semester = ?
        ''', (score, student_id, course_code, semester))
        self.conn.commit()
    
    def get_student_courses(self, student_id: str, semester: str = None) -> List[Dict]:
        """查詢學生的課程"""
        if semester:
            self.cursor.execute('''
                SELECT c.course_code, c.name, c.credits, c.teacher, e.score
                FROM enrollments e
                JOIN courses c ON e.course_id = c.id
                WHERE e.student_id = (SELECT id FROM students WHERE student_id = ?)
                AND e.semester = ?
            ''', (student_id, semester))
        else:
            self.cursor.execute('''
                SELECT c.course_code, c.name, c.credits, c.teacher, 
                       e.score, e.semester
                FROM enrollments e
                JOIN courses c ON e.course_id = c.id
                WHERE e.student_id = (SELECT id FROM students WHERE student_id = ?)
            ''', (student_id,))
        
        return [dict(row) for row in self.cursor.fetchall()]
    
    def get_student_gpa(self, student_id: str, semester: str = None) -> float:
        """計算學生 GPA"""
        if semester:
            self.cursor.execute('''
                SELECT AVG(e.score) as gpa
                FROM enrollments e
                WHERE e.student_id = (SELECT id FROM students WHERE student_id = ?)
                AND e.semester = ?
                AND e.score IS NOT NULL
            ''', (student_id, semester))
        else:
            self.cursor.execute('''
                SELECT AVG(e.score) as gpa
                FROM enrollments e
                WHERE e.student_id = (SELECT id FROM students WHERE student_id = ?)
                AND e.score IS NOT NULL
            ''', (student_id,))
        
        result = self.cursor.fetchone()
        return result['gpa'] if result['gpa'] else 0.0
    
    # === 統計報表 ===
    def get_statistics(self) -> Dict:
        """取得系統統計資訊"""
        stats = {}
        
        # 學生總數
        self.cursor.execute('SELECT COUNT(*) as count FROM students')
        stats['total_students'] = self.cursor.fetchone()['count']
        
        # 課程總數
        self.cursor.execute('SELECT COUNT(*) as count FROM courses')
        stats['total_courses'] = self.cursor.fetchone()['count']
        
        # 選課總數
        self.cursor.execute('SELECT COUNT(*) as count FROM enrollments')
        stats['total_enrollments'] = self.cursor.fetchone()['count']
        
        return stats
    
    def get_top_students(self, semester: str, limit: int = 10) -> List[Dict]:
        """查詢成績前幾名的學生"""
        self.cursor.execute('''
            SELECT 
                s.student_id,
                s.name,
                AVG(e.score) as avg_score,
                COUNT(e.id) as course_count
            FROM students s
            JOIN enrollments e ON s.id = e.student_id
            WHERE e.semester = ? AND e.score IS NOT NULL
            GROUP BY s.id
            ORDER BY avg_score DESC
            LIMIT ?
        ''', (semester, limit))
        
        return [dict(row) for row in self.cursor.fetchall()]
    
    def close(self):
        """關閉資料庫連線"""
        self.conn.close()


# === 使用範例 ===
def demo():
    """示範系統功能"""
    system = StudentManagementSystem()
    
    print("=== 學生管理系統 ===\n")
    
    # 1. 新增學生
    print("1. 新增學生")
    system.add_student('S001', 'Alice', 20, 'F', '0912345678', 'alice@example.com')
    system.add_student('S002', 'Bob', 21, 'M', '0987654321', 'bob@example.com')
    system.add_student('S003', 'Charlie', 19, 'M', '0923456789', 'charlie@example.com')
    print("學生新增完成\n")
    
    # 2. 新增課程
    print("2. 新增課程")
    system.add_course('CS101', 'Python 程式設計', 3, '王老師')
    system.add_course('CS102', '資料結構', 3, '李老師')
    system.add_course('CS103', '資料庫系統', 3, '張老師')
    print("課程新增完成\n")
    
    # 3. 學生選課
    print("3. 學生選課")
    system.enroll_course('S001', 'CS101', '2025-1')
    system.enroll_course('S001', 'CS102', '2025-1')
    system.enroll_course('S002', 'CS101', '2025-1')
    system.enroll_course('S002', 'CS103', '2025-1')
    print("選課完成\n")
    
    # 4. 更新成績
    print("4. 更新成績")
    system.update_score('S001', 'CS101', '2025-1', 95)
    system.update_score('S001', 'CS102', '2025-1', 88)
    system.update_score('S002', 'CS101', '2025-1', 92)
    system.update_score('S002', 'CS103', '2025-1', 85)
    print("成績更新完成\n")
    
    # 5. 查詢學生課程
    print("5. 查詢 Alice 的課程")
    courses = system.get_student_courses('S001', '2025-1')
    for course in courses:
        print(f"  {course['name']}：{course['score']} 分")
    
    # 6. 計算 GPA
    gpa = system.get_student_gpa('S001', '2025-1')
    print(f"  GPA：{gpa:.2f}\n")
    
    # 7. 查詢前幾名學生
    print("6. 2025-1 學期成績前 3 名")
    top_students = system.get_top_students('2025-1', 3)
    for i, student in enumerate(top_students, 1):
        print(f"  {i}. {student['name']} (學號：{student['student_id']})："
              f"{student['avg_score']:.2f} 分")
    
    # 8. 系統統計
    print("\n7. 系統統計")
    stats = system.get_statistics()
    print(f"  學生總數：{stats['total_students']}")
    print(f"  課程總數：{stats['total_courses']}")
    print(f"  選課總數：{stats['total_enrollments']}")
    
    system.close()


if __name__ == '__main__':
    demo()
</code></pre>
        </div>

        <div class="content">
            <div class="exercise-section">
                <h3>本週練習題</h3>
                
                <h4>基礎練習（必做）</h4>
                <ol>
                    <li>
                        <strong>通訊錄系統</strong><br>
                        建立簡單的通訊錄：
                        <ul>
                            <li>新增、查詢、更新、刪除聯絡人</li>
                            <li>欄位：姓名、電話、Email、地址</li>
                            <li>搜尋功能（按姓名或電話）</li>
                            <li>列出所有聯絡人</li>
                        </ul>
                    </li>
                    
                    <li>
                        <strong>待辦事項管理</strong><br>
                        建立 TODO List 系統：
                        <ul>
                            <li>新增待辦事項（標題、內容、期限）</li>
                            <li>標記完成/未完成</li>
                            <li>查詢未完成事項</li>
                            <li>刪除事項</li>
                            <li>按期限排序</li>
                        </ul>
                    </li>
                    
                    <li>
                        <strong>簡單記帳系統</strong><br>
                        記錄收支：
                        <ul>
                            <li>記錄收入/支出（日期、類別、金額、備註）</li>
                            <li>查詢特定期間的記錄</li>
                            <li>計算總收入、總支出、餘額</li>
                            <li>按類別統計</li>
                        </ul>
                    </li>
                </ol>

                <h4>進階練習</h4>
                <ol start="4">
                    <li>
                        <strong>圖書管理系統</strong><br>
                        管理圖書館藏：
                        <ul>
                            <li>圖書資料（書名、作者、ISBN、類別）</li>
                            <li>借閱記錄（借書人、借閱日期、歸還日期）</li>
                            <li>借閱/歸還功能</li>
                            <li>查詢可借閱書籍</li>
                            <li>查詢借閱歷史</li>
                            <li>逾期提醒</li>
                        </ul>
                    </li>
                    
                    <li>
                        <strong>員工考勤系統</strong><br>
                        記錄員工出勤：
                        <ul>
                            <li>員工資料管理</li>
                            <li>打卡記錄（上班/下班時間）</li>
                            <li>請假記錄</li>
                            <li>計算工時</li>
                            <li>月報表生成</li>
                            <li>異常記錄（遲到、早退）</li>
                        </ul>
                    </li>
                    
                    <li>
                        <strong>電商訂單系統</strong><br>
                        管理訂單資料：
                        <ul>
                            <li>商品管理（名稱、價格、庫存）</li>
                            <li>訂單管理（客戶、商品、數量）</li>
                            <li>訂單狀態追蹤</li>
                            <li>銷售統計</li>
                            <li>庫存警示</li>
                        </ul>
                    </li>
                </ol>

                <h4>挑戰練習</h4>
                <ol start="7">
                    <li>
                        <strong>完整的學生管理系統</strong><br>
                        如同上面的範例，自己實作：
                        <ul>
                            <li>學生、課程、選課管理</li>
                            <li>成績管理</li>
                            <li>GPA 計算</li>
                            <li>各種統計報表</li>
                            <li>匯出功能（CSV）</li>
                        </ul>
                    </li>
                    
                    <li>
                        <strong>專案時數追蹤系統</strong><br>
                        記錄專案工時：
                        <ul>
                            <li>專案管理</li>
                            <li>任務管理</li>
                            <li>時數記錄</li>
                            <li>成員管理</li>
                            <li>專案進度追蹤</li>
                            <li>時數統計與報表</li>
                        </ul>
                    </li>
                    
                    <li>
                        <strong>社群媒體資料庫</strong><br>
                        設計社群平台資料結構：
                        <ul>
                            <li>使用者管理</li>
                            <li>貼文管理</li>
                            <li>留言系統</li>
                            <li>按讚功能</li>
                            <li>追蹤/粉絲關係</li>
                            <li>動態時報生成</li>
                        </ul>
                    </li>
                </ol>

                <div class="tip-box">
                    <strong>練習提示：</strong>
                    <ul>
                        <li>先設計資料表結構（ER Diagram）</li>
                        <li>使用參數化查詢防止 SQL Injection</li>
                        <li>適當使用交易處理</li>
                        <li>添加錯誤處理</li>
                        <li>撰寫測試資料</li>
                        <li>考慮資料完整性（外鍵、唯一值等）</li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="content">
            <h2>本週總結</h2>
            
            <h3>重點回顧</h3>
            <ul>
                <li>✅ 理解資料庫基本概念</li>
                <li>✅ 掌握 SQL 基礎語法（CREATE、INSERT、SELECT、UPDATE、DELETE）</li>
                <li>✅ 學會使用 Python sqlite3 模組</li>
                <li>✅ 了解參數化查詢的重要性</li>
                <li>✅ 掌握進階查詢（JOIN、GROUP BY、子查詢）</li>
                <li>✅ 理解交易處理概念</li>
                <li>✅ 能夠設計簡單的資料庫系統</li>
                <li>✅ 實作完整的 CRUD 應用</li>
            </ul>

            <h3>SQL 速查表</h3>
            <div class="sql-box">
                <strong>常用 SQL 指令：</strong><br><br>
                <strong>建立表格：</strong><br>
                <code>CREATE TABLE table_name (column1 TYPE, column2 TYPE);</code><br><br>
                
                <strong>新增資料：</strong><br>
                <code>INSERT INTO table_name (col1, col2) VALUES (val1, val2);</code><br><br>
                
                <strong>查詢資料：</strong><br>
                <code>SELECT * FROM table_name WHERE condition;</code><br><br>
                
                <strong>更新資料：</strong><br>
                <code>UPDATE table_name SET col1 = val1 WHERE condition;</code><br><br>
                
                <strong>刪除資料：</strong><br>
                <code>DELETE FROM table_name WHERE condition;</code><br><br>
                
                <strong>聚合查詢：</strong><br>
                <code>SELECT col, COUNT(*) FROM table GROUP BY col;</code>
            </div>

            <h3>下週預告</h3>
            <div class="note-box">
                <h4>Week 10 - 網頁開發入門（Flask）</h4>
                <p>下週將學習使用 Flask 建立 Web 應用：</p>
                <ul>
                    <li>Flask 框架簡介</li>
                    <li>路由與視圖</li>
                    <li>模板引擎（Jinja2）</li>
                    <li>表單處理</li>
                    <li>Session 與 Cookie</li>
                    <li>REST API 開發</li>
                    <li>實作簡單的 Web 應用</li>
                </ul>
            </div>
        </div>

        <div class="nav-buttons">
            <a href="python-week8-part2.html" class="btn btn-secondary">← Week 8</a>
            <a href="python-week10.html" class="btn">Week 10：網頁開發 →</a>
        </div>

        <footer style="text-align: center; padding: 30px 0; color: #7f8c8d; margin-top: 50px; border-top: 1px solid #ddd;">
            <p style="margin: 10px 0;">Python 程式設計 Week 9</p>
            <p style="margin: 10px 0; font-size: 0.9em;">資料庫操作 · SQL · SQLite · CRUD · 交易處理</p>
            <p style="margin: 10px 0; font-size: 0.85em; color: #95a5a6;">© 2025 All Rights Reserved</p>
        </footer>
    </div>
</body>
</html>